!function(e){"use strict";function n(e,n){return 0===toString.call(n).indexOf("[object "+e)}function r(e){return u[e]?new Promise(function(n){u[e].on("ready",function(){n(u[e])}).on("error",function(n){reject(new Error("error initializing node ["+e+"]: "+n))})}):d[e]?d[e]:(d[e]=new Promise(function(n,r){if(!f[e])return void r(new Error("node load paths not defined ["+e+"]"));var o=f[e].length;f[e].forEach(function(a){t(a,function(t){return t.success?(o--,void(o||(u[e]?u[e].on("ready",function(){n(u[e])}).on("error",function(n){r(new Error("error initializing node ["+e+"]: "+n))}):(u[e]=!0,n())))):void r(new Error("could not load ["+a+"] of node ["+e+"]"))})})}),d[e])}function t(n,r){function t(n){n=n||e.event;var t="addEventListener"in e?{}:{loaded:1,complete:1};("load"==n.type||t[a.readyState])&&(a.onload=a.onreadystatechange=a.onerror="",r({success:!0}))}function o(e){r({success:!1,message:"error: requesting url ["+n+"]"})}var a=g.createElement("script");a.onload=a.onreadystatechange=t,a.onerror=o,a.type="text/javascript",a.charset="utf-8",a.async=!0,a.src=n;var i=g.getElementsByTagName("script")[0];i.parentNode.insertBefore(a,i)}function o(e,n){l[e]?(l[e].triggered=!0,l[e].payload=n,l[e].callbacks&&l[e].callbacks.forEach(function(e){e(n)})):l[e]={triggered:!0}}function a(e,n){l[e]?l[e].triggered?n(l[e].payload):l[e].callbacks.push(n):l[e]={triggered:!1,callbacks:[n]}}var i="0.1.2",s={},c=0,u={},d={},f={},l={},g=e.document,p=e.setTimeout,h={INITIAL:0,RUNNABLE:1,READY:2},m=e.XI=e.Îž=function(e,t,d){var f={_version:i,_id:c++,_messages:[],_state:h.INITIAL,nodes:{}},l=[];n("String",e)?(f.name=e,u[e]=f):(f.name="anonymous"+f._id,t=arguments[0],d=arguments[1]),n("Array",t)||(d=t,t=[]),f.on=function(e,n){return a(f.name+"@"+e,n),f},f.trigger=function(e,n){return o(f.name+"@"+e,n),f},f.addDependency=function(e){f._state===h.INITIAL?t.push(e):f._messages.push("dependencies: could not add dynamic dependency ["+e+"]")};for(var g in d)d.hasOwnProperty(g)&&(s[g]&&(s[g].call(f,d[g]),l.push(g)),f[g]=d[g]);return a("document-runnable",function(){var e=t.length;f.state="runnable",e?t.forEach(function(n){f.nodes[n]={},r(n).then(function(r){r||r!==!0?f.nodes[n]=r:f._messages.push("dependencies: no node found in package ["+n+"]"),e--,e||(f.state="ready",f.trigger("ready"))})["catch"](function(e){f._messages.push(e),f.trigger("error",e)})}):(f.state="ready",f.trigger("ready"))}),f};m._version=i,m.register=function(e,n){"function"==typeof n?s[e]=n:this._messages.push("handler: registered without callback function ["+e+"]")},m.paths=function(n){if(!n.XI)throw Error("path to XI folder not defined");f=n,f["XI.streams"]=[n.XI+"/streams.XI.js"],e.Promise?o("runnable"):t(f.XI+"/promise.XI.js",!1,function(e){if(!e.success)throw Error("could not load promise polyfill ... stoppping execution");o("runnable")})},e.addEventListener("load",function(){p(function(){o("document-runnable")},0)}),m.register("run",function(e){var n=this;p(function(){try{e.call(n)}catch(r){n.trigger("error",r)}})}),m.register("ready",function(e){var n=this,r=[];n.on("ready",function(){try{for(var t in n.nodes)n.nodes.hasOwnProperty(t)&&r.push(n.nodes[t]);e.apply(n,r)}catch(o){n.trigger("error",o)}})})}(this);